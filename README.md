# Automated Speech Recognition with Search Interface

## Introduction
This is a full stack application built using the Vite React.js framework for the frontend and the FastAPI framework for the backend.


The purpose of this application is to provide a platform for users to search through audio files that have been transcribed into text using the [Facebook Wav2Vec2 speech model](https://huggingface.co/facebook/wav2vec2-large-960h). The transcribed text is then stored in a csv that is indexed to ElasticSearch, and can be searched using the search interface provided in the frontend application deployed [here](http://asr-fe-bucket.s3-website-ap-southeast-1.amazonaws.com).

Should the deployed frontend application be unavailable, you may run the application locally by following the instructions below.

## Getting Started


### Prerequisites
- [Docker](https://docs.docker.com/get-docker/) needs to be installed on your machine.
- [Python 3.8](https://www.python.org/downloads/release/python-380/) needs to be installed on your machine.
- Port 9200 and 5173 needs to be available on your machine.

## Running ASR Inference API (Task 2)

1. Navigate to root directory of the project.
2. Start python virtual environment

    ```source venv/bin/activate``` (for mac)

    ```venv\Scripts\activate``` (for windows)

3. Install dependencies
```pip install -r requirements.txt```

    note: brew install ffmpeg (for mac) or download ffmpeg from https://ffmpeg.org/download.html (for windows) if not installed.

4. Deactivate ```deactivate``` and reactivate (step 2) the virtual environment to ensure the new dependencies are loaded.

5. Navigate to the directory with the API
```cd asr```

6. To run the FASTAPI server with hot reload
```uvicorn main:app --reload```

7. Test on localhost and access autogenerated swagger API documentation [here](http://127.0.0.1:8000/docs).

8. To deactivate the virtual environment
```deactivate```.


## Running ElasticSearch Backend and Search-UI Locally
1. Clone the repository to your local machine.
2. Start docker on your machine.

### Backend Setup
3. Navigate to the backend directory using `cd elastic-backend`
4. Run `docker-compose up` to start the backend ElasticSearch cluster.
5. Comment out the existing code on lines 9-10 in the ```cv-index.py``` file and uncomment line 14.

        es = Elasticsearch("http://ec2-13-229-61-124.ap-southeast-1.compute.amazonaws.com:9200) # comment this out (lines 9-10)

        es = Elasticsearch("http://localhost:9200") # use this (line 14)
6. Run ```python cv-index.py``` to index the csv file to ElasticSearch.

### Frontend Setup
7. Open a new terminal window and navigate to the frontend directory using `cd search-ui`.
8. Run `npm install` to install the frontend dependencies.
9. Comment out the existing code on line 23 and uncomment line 24 in the `App.tsx` file.

        function App() {
            const connector = new ElasticsearchAPIConnector({
                host: "http://ec2-13-229-61-124.ap-southeast-1.compute.amazonaws.com:9200", // comment this out (line 23)
                // host: "http://localhost:9200", // use this (line 24)
                index: "cv-transcription"
            });
  
10. Run `npm run dev` to start the frontend application in development mode.
11. The frontend application will be accessible at [`http://localhost:5173`](http://localhost:5173).


### Tear down and Clean-up
1. Press `Ctrl + C` to stop the application.
2. Run `docker-compose down` to stop the containers.
3. Run `docker-compose rm` to remove the containers.
4. Run `docker volume prune` to remove the volumes.
5. Run `docker network prune` to remove the network.
6. Run `docker image prune` to remove the images.
7. Run `docker system prune` to remove all unused data.

## Editor's Note
- The application is deployed on AWS EC2 and S3. The backend is deployed on an EC2 instance and the frontend is deployed on an S3 bucket. The ElasticSearch Cluster is accessible at [http://ec2-13-229-61-124.ap-southeast-1.compute.amazonaws.com:9200](http://ec2-13-229-61-124.ap-southeast-1.compute.amazonaws.com:9200) and the frontend application is accessible at [http://asr-fe-bucket.s3-website-ap-southeast-1.amazonaws.com](http://asr-fe-bucket.s3-website-ap-southeast-1.amazonaws.com).
- A ```Dockerfile``` and ```nginx.conf``` file are included in the frontend directory for deployment via containers if required. The Dockerfile is configured to build the application and served using Nginx.
- The ElasticSearch Cluster is currently manually configured on the EC2 instance following the configurations in the local ```docker-compose.yml``` file which disables security features. For production, it is recommended to enable security features and configure the cluster accordingly.